<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ - æ—…éŠå°åŠ©æ‰‹</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="unpkg.com"></script>
    <!-- Lucide Icons (æ‰‹ç¹ªæ„Ÿåœ–ç¤º) -->
    <script src="unpkg.com"></script>
    <!-- SortableJS (æ‹–æ›³åŠŸèƒ½) -->
    <script src="cdn.jsdelivr.net"></script>
    <style>
        @import url('fonts.googleapis.com');
        :root {
            --morandi-purple: #9A94BC;
            --morandi-blue: #A3B9C9;
            --morandi-bg: #F4F5F7;
            --morandi-text: #5A5A5A;
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--morandi-bg);
            color: var(--morandi-text);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .date-chip-active {
            background-color: var(--morandi-purple) !important;
            color: white !important;
        }
        .category-tag {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
        }
        /* æ—¥ç³»ç°¡ç´„éæ¸¡å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app" class="app-container relative">
    <!-- Header -->
    <header class="p-6 bg-white sticky top-0 z-20">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold text-[#7E749B]">Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ âœ¨</h1>
                <p class="text-xs text-gray-400">8 Days Adventure in Japan</p>
            </div>
            <button @click="activeTab = 'shopping'" class="p-2 bg-[#F0EEF6] rounded-full text-[#9A94BC]">
                <i data-lucide="shopping-bag"></i>
            </button>
        </div>

        <!-- æ©«å‘æ»‘å‹•æ—¥æœŸé¸å–® -->
        <div v-if="activeTab === 'itinerary'" class="flex overflow-x-auto hide-scrollbar space-x-3 py-2">
            <div 
                v-for="(day, index) in itineraryDays" 
                :key="index"
                @click="selectedDayIndex = index"
                :class="['flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center border transition-all', 
                         selectedDayIndex === index ? 'date-chip-active border-transparent' : 'bg-white border-gray-100']"
            >
                <span class="text-[10px] uppercase">Day</span>
                <span class="text-lg font-bold">{{ index + 1 }}</span>
                <span class="text-[10px]">{{ day.dateShort }}</span>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 px-4 pb-24 overflow-y-auto">
        
        <!-- é¦–é è³‡è¨Šå¡ç‰‡ (ç•¶ activeTab ç‚º home æ™‚) -->
        <div v-if="activeTab === 'home'" class="space-y-4 animate-in fade-in">
            <div class="bg-gradient-to-br from-[#9A94BC] to-[#A3B9C9] p-5 rounded-3xl text-white shadow-lg mb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-80 text-sm">ä»Šæ—¥å¤©æ°£ (åå¤å±‹)</p>
                        <h2 class="text-3xl font-bold">{{ weather.temp }}Â°C</h2>
                        <p class="text-sm italic">{{ weather.desc }}</p>
                    </div>
                    <i data-lucide="cloud-sun" class="w-12 h-12"></i>
                </div>
            </div>

            <div class="bg-[#F8F9FB] p-4 rounded-2xl border border-gray-50">
                <div class="flex items-center gap-3 mb-3 text-[#7E749B]">
                    <i data-lucide="plane"></i><h3 class="font-bold">èˆªç­è³‡è¨Š</h3>
                </div>
                <div class="flex justify-between text-sm">
                    <div class="text-center bg-white p-2 rounded-xl flex-1 mr-2 border border-gray-100">
                        <p class="text-gray-400">å»ç¨‹</p>
                        <p class="font-bold text-[#9A94BC]">CI154</p>
                    </div>
                    <div class="text-center bg-white p-2 rounded-xl flex-1 border border-gray-100">
                        <p class="text-gray-400">å›ç¨‹</p>
                        <p class="font-bold text-[#9A94BC]">CI109</p>
                    </div>
                </div>
            </div>

            <div class="bg-[#F8F9FB] p-4 rounded-2xl border border-gray-50">
                <div class="flex items-center gap-3 mb-3 text-[#7E749B]">
                    <i data-lucide="hotel"></i><h3 class="font-bold">ä½å®¿è³‡è¨Š</h3>
                </div>
                <div class="space-y-3 text-xs leading-relaxed">
                    <div class="bg-white p-3 rounded-xl border border-gray-100">
                        <p class="font-bold text-[#9A94BC]">12/24 - 12/28 åå¤å±‹çš‡å®¶èŠ±åœ’æ¨™èªŒé£¯åº—</p>
                        <p class="text-gray-400 mt-1">4-1-1 Sakae, Naka-ku, Nagoya City</p>
                    </div>
                    <div class="bg-white p-3 rounded-xl border border-gray-100">
                        <p class="font-bold text-[#9A94BC]">12/28 - 12/31 æ±äº¬é¾åé¤¨</p>
                        <p class="text-gray-400 mt-1">æ±äº¬éƒ½ä¸­å¤®åŒºå…«é‡æ´²1-3-22 15éš</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- é ç±¤1ï¼šæ¯æ—¥è¡Œç¨‹è¡¨ -->
        <div v-if="activeTab === 'itinerary'" class="space-y-4">
            <draggable v-model="currentDayEvents" item-key="id" handle=".drag-handle">
                <template #item="{element, index}">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-3 relative group">
                        <div class="flex items-start gap-3">
                            <div class="drag-handle cursor-grab text-gray-300 pt-1">
                                <i data-lucide="grip-vertical" class="w-4 h-4"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs font-mono text-white px-2 py-0.5 rounded bg-[#9A94BC]">{{ element.time }}</span>
                                    <span :class="['category-tag', categoryColors[element.category]]">{{ element.category }}</span>
                                </div>
                                <h4 class="font-bold text-gray-700">{{ element.location }}</h4>
                                <p class="text-xs text-gray-400 mt-1" v-if="element.note">{{ element.note }}</p>
                            </div>
                            <button @click="deleteEvent(index)" class="text-red-300 hover:text-red-500">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </draggable>
            <button @click="showAddEventModal = true" class="w-full py-3 border-2 border-dashed border-[#D1D5DB] rounded-2xl text-gray-400 flex items-center justify-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> æ–°å¢è¡Œç¨‹
            </button>
        </div>

        <!-- é ç±¤2ï¼šåˆ†å¸³åŠŸèƒ½ -->
        <div v-if="activeTab === 'expenses'" class="space-y-4">
            <div class="bg-[#F0EEF6] p-5 rounded-3xl mb-4">
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-xs text-[#7E749B]">ç¸½èŠ±è²»çµ±è¨ˆ (TWD)</p>
                        <h2 class="text-3xl font-bold text-[#7E749B]">NT$ {{ totalExpensesTWD }}</h2>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400">åŒ¯ç‡åƒè€ƒ: 1 JPY = 0.21 TWD</p>
                    </div>
                </div>
            </div>
            
            <div v-for="(exp, idx) in expenses" :key="idx" class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-gray-50">
                <div>
                    <p class="font-medium">{{ exp.title }}</p>
                    <p class="text-xs text-gray-400">{{ exp.currency === 'JPY' ? 'Â¥' + exp.amount : '$' + exp.amount }} â‰ˆ NT$ {{ convertToTWD(exp) }}</p>
                </div>
                <button @click="expenses.splice(idx, 1)" class="text-gray-300 hover:text-red-400">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="bg-white p-4 rounded-2xl shadow-md border border-[#9A94BC]/20">
                <input v-model="newExp.title" placeholder="é …ç›®åç¨±" class="w-full mb-2 p-2 text-sm border-b focus:outline-none">
                <div class="flex gap-2">
                    <input v-model.number="newExp.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-2 text-sm border-b focus:outline-none">
                    <select v-model="newExp.currency" class="p-2 text-sm border-b focus:outline-none">
                        <option value="JPY">æ—¥å¹£ (JPY)</option>
                        <option value="TWD">å°å¹£ (TWD)</option>
                    </select>
                </div>
                <button @click="addExpense" class="w-full mt-4 bg-[#9A94BC] text-white py-2 rounded-xl text-sm">æ–°å¢è¨˜éŒ„</button>
            </div>
        </div>

        <!-- é ç±¤3ï¼šå‚™ç”¨æ™¯é» -->
        <div v-if="activeTab === 'places'" class="space-y-3">
            <div v-for="(place, idx) in backupPlaces" :key="idx" class="flex items-center gap-3 bg-white p-4 rounded-2xl border border-gray-100 shadow-sm">
                <input type="checkbox" v-model="place.done" class="w-5 h-5 accent-[#9A94BC]">
                <div class="flex-1">
                    <p :class="{'line-through text-gray-300': place.done}" class="font-medium">{{ place.name }}</p>
                    <p class="text-[10px] text-gray-400">{{ place.address }}</p>
                </div>
                <button @click="backupPlaces.splice(idx, 1)" class="text-gray-300"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            <div class="p-4 bg-gray-50 rounded-2xl">
                <input v-model="newPlace.name" placeholder="æ™¯é»åç¨±" class="w-full mb-2 p-2 bg-transparent border-b text-sm focus:outline-none">
                <input v-model="newPlace.address" placeholder="åœ°å€/å‚™è¨»" class="w-full mb-3 p-2 bg-transparent border-b text-sm focus:outline-none">
                <button @click="addPlace" class="w-full bg-gray-400 text-white py-2 rounded-xl text-sm italic">+ Add Place</button>
            </div>
        </div>

        <!-- é ç±¤4ï¼šTODO -->
        <div v-if="activeTab === 'todo'" class="space-y-3">
            <div v-for="(item, idx) in todos" :key="idx" class="flex items-center gap-3 bg-white p-3 rounded-xl border border-gray-100">
                <input type="checkbox" v-model="item.done" class="accent-[#9A94BC]">
                <input v-model="item.text" class="flex-1 bg-transparent border-none focus:outline-none text-sm" :class="{'line-through text-gray-300': item.done}">
                <button @click="todos.splice(idx, 1)" class="text-gray-300"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            <button @click="todos.push({text: 'æ–°å¾…è¾¦äº‹é …', done: false})" class="text-sm text-[#9A94BC] font-bold">+ æ–°å¢å¾…è¾¦äº‹é …</button>
        </div>

        <!-- è³¼ç‰©æ¸…å–® (å³ä¸Šæ–¹å…¥å£) -->
        <div v-if="activeTab === 'shopping'" class="animate-in slide-in-from-right">
            <div class="flex items-center gap-2 mb-4">
                <button @click="activeTab = 'home'" class="text-gray-400"><i data-lucide="chevron-left"></i></button>
                <h3 class="font-bold">Shopping List ğŸ›ï¸</h3>
            </div>
            <div class="grid grid-cols-1 gap-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-[#FDFDFD] p-4 rounded-2xl border border-gray-100 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" v-model="item.bought" class="w-5 h-5 rounded-full accent-[#A3B9C9]">
                        <span :class="{'line-through text-gray-300': item.bought}">{{ item.name }}</span>
                    </div>
                    <button @click="shoppingList.splice(idx, 1)" class="text-gray-200"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>
                <div class="mt-4 flex gap-2">
                    <input v-model="newShopItem" @keyup.enter="addShopItem" placeholder="æƒ³è²·ä»€éº¼å‘¢ï¼Ÿ" class="flex-1 bg-gray-100 rounded-xl px-4 py-2 text-sm outline-none">
                    <button @click="addShopItem" class="bg-[#A3B9C9] text-white px-4 py-2 rounded-xl">Add</button>
                </div>
            </div>
        </div>

    </main>

    <!-- è¡Œç¨‹æ–°å¢å½ˆçª— (Modal) -->
    <div v-if="showAddEventModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6">
        <div class="bg-white w-full rounded-3xl p-6">
            <h3 class="font-bold mb-4 text-[#7E749B]">æ–°å¢è¡Œç¨‹</h3>
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input v-model="newEvent.time" type="time" class="flex-1 border-b p-2 outline-none">
                    <select v-model="newEvent.category" class="flex-1 border-b p-2 outline-none">
                        <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>
                </div>
                <input v-model="newEvent.location" placeholder="åœ°é»åç¨±" class="w-full border-b p-2 outline-none">
                <textarea v-model="newEvent.note" placeholder="å‚™è¨»" class="w-full border-b p-2 outline-none h-20 text-sm"></textarea>
                <div class="flex gap-3">
                    <button @click="showAddEventModal = false" class="flex-1 py-3 bg-gray-100 rounded-2xl text-gray-500">å–æ¶ˆ</button>
                    <button @click="addEvent" class="flex-1 py-3 bg-[#9A94BC] rounded-2xl text-white">ç¢ºå®šæ–°å¢</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation (æ‰‹ç¹ªåœ–ç¤º) -->
    <nav class="fixed bottom-0 w-full max-w-[500px] bg-white border-t border-gray-100 flex justify-around items-center py-3 pb-6 z-20">
        <button @click="activeTab = 'home'" :class="activeTab === 'home' ? 'text-[#9A94BC]' : 'text-gray-300'">
            <i data-lucide="home"></i>
        </button>
        <button @click="activeTab = 'itinerary'" :class="activeTab === 'itinerary' ? 'text-[#9A94BC]' : 'text-gray-300'">
            <i data-lucide="calendar"></i>
        </button>
        <button @click="activeTab = 'expenses'" :class="activeTab === 'expenses' ? 'text-[#9A94BC]' : 'text-gray-300'">
            <i data-lucide="banknote"></i>
        </button>
        <button @click="activeTab = 'places'" :class="activeTab === 'places' ? 'text-[#9A94BC]' : 'text-gray-300'">
            <i data-lucide="map-pin"></i>
        </button>
        <button @click="activeTab = 'todo'" :class="activeTab === 'todo' ? 'text-[#9A94BC]' : 'text-gray-300'">
            <i data-lucide="check-square"></i>
        </button>
    </nav>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    const app = createApp({
        setup() {
            // åŸºç¤è³‡æ–™
            const activeTab = ref('home');
            const selectedDayIndex = ref(0);
            const showAddEventModal = ref(false);
            const weather = ref({ temp: 8, desc: 'æ™´æ™‚å¤šé›² â„ï¸' });
            
            const categories = ['æ™¯é»', 'äº¤é€š', 'èˆªç­', 'ç¾é£Ÿ', 'è³¼ç‰©', 'å…¶ä»–'];
            const categoryColors = {
                'æ™¯é»': 'bg-green-100 text-green-600',
                'äº¤é€š': 'bg-blue-100 text-blue-600',
                'èˆªç­': 'bg-indigo-100 text-indigo-600',
                'ç¾é£Ÿ': 'bg-orange-100 text-orange-600',
                'è³¼ç‰©': 'bg-pink-100 text-pink-600',
                'å…¶ä»–': 'bg-gray-100 text-gray-600'
            };

            // å„é …è³‡æ–™ç‹€æ…‹ (å„ªå…ˆå¾ LocalStorage è®€å–)
            const itineraryDays = ref(JSON.parse(localStorage.getItem('itinerary')) || [
                { dateShort: '12/24', events: [{ id: 1, time: '14:00', category: 'èˆªç­', location: 'æŠµé”åå¤å±‹ (CI154)', note: 'é–‹å•Ÿé©šå–œä¹‹æ—…ï¼' }] },
                { dateShort: '12/25', events: [] },
                { dateShort: '12/26', events: [] },
                { dateShort: '12/27', events: [] },
                { dateShort: '12/28', events: [{ id: 2, time: '11:00', category: 'äº¤é€š', location: 'ç§»å‹•è‡³æ±äº¬', note: 'æ–°å¹¹ç·šåˆé«”é©—' }] },
                { dateShort: '12/29', events: [] },
                { dateShort: '12/30', events: [] },
                { dateShort: '12/31', events: [] },
            ]);

            const expenses = ref(JSON.parse(localStorage.getItem('expenses')) || []);
            const backupPlaces = ref(JSON.parse(localStorage.getItem('places')) || []);
            const todos = ref(JSON.parse(localStorage.getItem('todos')) || [
                { text: 'å¸¶è­·ç…§', done: true },
                { text: 'æ—¥å¹£æ›åŒ¯', done: false }
            ]);
            const shoppingList = ref(JSON.parse(localStorage.getItem('shopping')) || []);

            // æ–°å¢æš«å­˜é …
            const newEvent = ref({ time: '10:00', category: 'æ™¯é»', location: '', note: '' });
            const newExp = ref({ title: '', amount: null, currency: 'JPY' });
            const newPlace = ref({ name: '', address: '', done: false });
            const newShopItem = ref('');

            // è¨ˆç®—å±¬æ€§
            const currentDayEvents = computed({
                get: () => itineraryDays.value[selectedDayIndex.value].events,
                set: (val) => { itineraryDays.value[selectedDayIndex.value].events = val; }
            });

            const totalExpensesTWD = computed(() => {
                return expenses.value.reduce((sum, item) => sum + convertToTWD(item), 0).toLocaleString();
            });

            // æ–¹æ³•
            const convertToTWD = (item) => {
                if (item.currency === 'TWD') return item.amount;
                return Math.round(item.amount * 0.21); // å‡è¨­åŒ¯ç‡ 0.21
            };

            const addEvent = () => {
                if (!newEvent.value.location) return;
                itineraryDays.value[selectedDayIndex.value].events.push({
                    id: Date.now(),
                    ...newEvent.value
                });
                newEvent.value = { time: '10:00', category: 'æ™¯é»', location: '', note: '' };
                showAddEventModal.value = false;
                refreshIcons();
            };

            const deleteEvent = (idx) => {
                itineraryDays.value[selectedDayIndex.value].events.splice(idx, 1);
            };

            const addExpense = () => {
                if (!newExp.value.title || !newExp.value.amount) return;
                expenses.value.push({ ...newExp.value });
                newExp.value = { title: '', amount: null, currency: 'JPY' };
            };

            const addPlace = () => {
                if (!newPlace.value.name) return;
                backupPlaces.value.push({ ...newPlace.value });
                newPlace.value = { name: '', address: '', done: false };
                refreshIcons();
            };

            const addShopItem = () => {
                if (!newShopItem.value) return;
                shoppingList.value.push({ name: newShopItem.value, bought: false });
                newShopItem.value = '';
                refreshIcons();
            };

            const refreshIcons = () => {
                setTimeout(() => lucide.createIcons(), 10);
            };

            // ç›£è½ä¸¦è‡ªå‹•å„²å­˜
            watch([itineraryDays, expenses, backupPlaces, todos, shoppingList], () => {
                localStorage.setItem('itinerary', JSON.stringify(itineraryDays.value));
                localStorage.setItem('expenses', JSON.stringify(expenses.value));
                localStorage.setItem('places', JSON.stringify(backupPlaces.value));
                localStorage.setItem('todos', JSON.stringify(todos.value));
                localStorage.setItem('shopping', JSON.stringify(shoppingList.value));
                refreshIcons();
            }, { deep: true });

            onMounted(() => {
                lucide.createIcons();
            });

            return {
                activeTab, selectedDayIndex, itineraryDays, currentDayEvents, 
                showAddEventModal, newEvent, categories, categoryColors,
                expenses, newExp, totalExpensesTWD, convertToTWD, addExpense,
                backupPlaces, newPlace, addPlace,
                todos, shoppingList, newShopItem, addShopItem,
                weather, deleteEvent
            };
        }
    });

    app.component('draggable', window.vuedraggable);
    app.mount('#app');
</script>

</body>
</html>
