<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Carlos 生日摘星星</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --blue: #94a7ae; --gray: #e2e2e2; --bg: #f8f9fa; --text: #4a4a4a; --accent: #c5a48e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; }
       
        header { background: var(--blue); color: white; padding: 50px 20px 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-title { font-size: 1.2rem; letter-spacing: 2px; margin: 0; font-weight: 700; }
       
        .date-slider { display: flex; overflow-x: auto; background: white; padding: 12px; gap: 12px; border-bottom: 1px solid var(--gray); scrollbar-width: none; position: sticky; top: 85px; z-index: 90; }
        .date-slider::-webkit-scrollbar { display: none; }
        .date-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 60px; height: 70px; border-radius: 15px; background: #f2f2f2; border: none; flex-shrink: 0; }
        .date-btn .wk { font-size: 1rem; font-weight: 700; color: #888; }
        .date-btn .dt { font-size: 0.8rem; color: #aaa; }
        .date-btn.active { background: var(--blue); color: white; }
        .date-btn.active .wk, .date-btn.active .dt { color: white; }

        .container { padding: 15px; }
        .card { background: white; border-radius: 18px; padding: 18px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; border: 1px solid #efefef; }
       
        .weather-info { background: white; border-radius: 18px; padding: 15px; margin-bottom: 18px; display: flex; align-items: center; gap: 15px; border: 1px solid #eee; cursor: pointer; }
        .city-tag { font-size: 0.7rem; background: var(--blue); color: white; padding: 2px 6px; border-radius: 5px; margin-bottom: 3px; display: inline-block; }

        .fab { position: fixed; bottom: 85px; right: 20px; width: 56px; height: 56px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: none; z-index: 500; }
       
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: white; display: flex; border-top: 1px solid #eee; padding-bottom: env(safe-area-inset-bottom); z-index: 1000; }
        .nav-tab { flex: 1; border:none; background:none; color: #bbb; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; font-family: inherit; }
        .nav-tab.active { color: var(--blue); font-weight: bold; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-height: 80vh; border-radius: 25px; padding: 25px; overflow-y: auto; }
       
        /* 統一所有輸入框樣式，確保時間框一致 */
        input[type="text"], 
        input[type="time"], 
        input[type="number"], 
        select, 
        textarea { 
            width: 100%; 
            height: 48px; 
            padding: 12px; 
            margin: 6px 0 16px 0; 
            border: 1px solid #eee; 
            border-radius: 12px; 
            font-size: 1rem; 
            font-family: inherit;
            background-color: #fafafa;
            display: block;
            -webkit-appearance: none;
        }
        textarea { height: auto; }
        .field-lbl { display: block; font-size: 0.85rem; color: #666; font-weight: 700; margin-top: 10px; margin-left: 4px; }

        .save-btn { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: 700; margin-top: 10px; font-size: 1rem; }
        .cancel-btn { width: 100%; border: none; background: none; color: #aaa; margin-top: 10px; padding: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

<header><div class="header-title" id="tabTitle">Carlos 生日摘星星</div></header>

<div class="date-slider" id="dateSlider"></div>
<div class="container" id="mainView"></div>

<button class="fab" id="fabBtn" onclick="openModal()">
    <svg viewBox="0 0 24 24" width="28" height="28" stroke="white" stroke-width="3" fill="none"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
</button>

<nav class="bottom-nav">
    <button class="nav-tab active" onclick="goTab('trip')">行程</button>
    <button class="nav-tab" onclick="goTab('todo')">TODO</button>
    <button class="nav-tab" onclick="goTab('back')">備案</button>
    <button class="nav-tab" onclick="goTab('wallet')">記帳</button>
</nav>

<div id="modal" class="modal"><div class="modal-content" id="modalInner"></div></div>

<script>
    let day = 0, tab = 'trip';
    const store = (k, v) => v ? localStorage.setItem(k, JSON.stringify(v)) : JSON.parse(localStorage.getItem(k));
    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
   
    let tripData = store('c_trip_final_v5') || Array(8).fill().map(()=>[]);
    let todoData = store('c_todo') || [];

    function goTab(t) { tab = t; render(); }

    function render() {
        const view = document.getElementById('mainView');
        const slider = document.getElementById('dateSlider');
        const title = document.getElementById('tabTitle');
       
        slider.style.display = (tab === 'trip') ? 'flex' : 'none';
        document.querySelectorAll('.nav-tab').forEach((n,i)=>n.classList.toggle('active', ['trip','todo','back','wallet'].indexOf(tab)===i));
       
        let h = '';
        if(tab === 'trip') {
            title.innerText = "行程規劃";
            slider.innerHTML = '';
            for(let i=0; i<8; i++){
                let d = new Date(2025, 11, 24+i);
                slider.innerHTML += `<button class="date-btn ${i===day?'active':''}" onclick="day=${i};render()"><span class="wk">${weekdays[d.getDay()]}</span><span>${d.getDate()}</span></button>`;
            }

            let city = day >= 4 ? '東京 Tokyo' : '名古屋 Nagoya';
            h += `<div class="weather-info"><div><span class="city-tag">${city}</span><div style="font-weight:700">12/${24+day} 預報行程</div></div></div>`;
           
            if(tripData[day].length === 0) {
                h += `<p style="text-align:center; color:#ccc; margin-top:50px;">本日尚無行程，點擊右下角新增</p>`;
            } else {
                tripData[day].forEach((item, idx) => {
                    h += `<div class="card" onclick="openModal(${idx})">
                            <div style="display:flex; justify-content:space-between;">
                                <strong>${item.time || '未定時'}</strong>
                                <span style="color:var(--blue); font-size:0.8rem;">編輯</span>
                            </div>
                            <div style="font-size:1.1rem; margin:5px 0;">${item.t}</div>
                            <div style="font-size:0.85rem; color:#888;">${item.addr}</div>
                          </div>`;
                });
            }
        } else {
            h = `<p style="text-align:center; padding:50px;">${tab.toUpperCase()} 功能開發中...</p>`;
        }
        view.innerHTML = h;
    }

    function openModal(editIdx = null) {
        const modal = document.getElementById('modal');
        const inner = document.getElementById('modalInner');
        modal.style.display = 'flex';

        if (tab === 'trip') {
            let item = editIdx !== null ? tripData[day][editIdx] : { t: '', time: '', addr: '', note: '' };
            inner.innerHTML = `
                <h3 style="margin-top:0; color:var(--blue);">${editIdx !== null ? '編輯' : '新增'} 行程</h3>
                <label class="field-lbl">行程名稱</label>
                <input type="text" id="m_title" value="${item.t}" placeholder="例如：利久牛舌">
                <label class="field-lbl">抵達時間</label>
                <input type="time" id="m_time" value="${item.time}">
                <label class="field-lbl">地點/地址</label>
                <input type="text" id="m_addr" value="${item.addr}" placeholder="請輸入地點或連結">
                <label class="field-lbl">備註</label>
                <textarea id="m_note" rows="3">${item.note || ''}</textarea>
                <button class="save-btn" onclick="saveTrip(${editIdx})">儲存</button>
                <button class="cancel-btn" onclick="closeModal()">取消</button>
            `;
        }
    }

    function saveTrip(idx) {
        const newItem = {
            t: document.getElementById('m_title').value,
            time: document.getElementById('m_time').value,
            addr: document.getElementById('m_addr').value,
            note: document.getElementById('m_note').value
        };
        if(idx !== null) tripData[day][idx] = newItem;
        else tripData[day].push(newItem);
       
        // 依照時間排序
        tripData[day].sort((a, b) => (a.time > b.time ? 1 : -1));
       
        store('c_trip_final_v5', tripData);
        closeModal();
        render();
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    render();
</script>

</body>
</html>
