<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="fonts.googleapis.com" rel="stylesheet">
    <script src="cdn.jsdelivr.net"></script>
    <style>
        :root { --blue: #94a7ae; --gray: #e2e2e2; --bg: #f8f9fa; --text: #4a4a4a; --accent: #c5a48e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; }
        
        /* Banner & Header */
        .banner { width: 100%; height: 180px; background-color: #d1d9db; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; border-bottom: 2px solid var(--blue); }
        .illustration { font-size: 80px; line-height: 1; }
        .banner-text { position: absolute; bottom: 10px; color: white; font-weight: 700; text-shadow: 1px 1px 4px rgba(0,0,0,0.2); }
        
        header { background: var(--blue); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        
        /* æ—¥æœŸåˆ— */
        .date-slider { display: flex; overflow-x: auto; background: white; padding: 12px; gap: 12px; border-bottom: 1px solid var(--gray); scrollbar-width: none; position: sticky; top: 50px; z-index: 90; }
        .date-slider::-webkit-scrollbar { display: none; }
        .date-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 60px; height: 70px; border-radius: 15px; background: #f2f2f2; border: none; flex-shrink: 0; }
        .date-btn .wk { font-size: 1rem; font-weight: 700; color: #888; }
        .date-btn.active { background: var(--blue); color: white; }
        .date-btn.active .wk { color: white; }

        .container { padding: 15px; }
        .card { background: white; border-radius: 18px; padding: 18px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; border: 1px solid #efefef; }
        
        /* æµ®å‹•æŒ‰éˆ• */
        .fab { position: fixed; bottom: 85px; right: 20px; width: 56px; height: 56px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: none; z-index: 500; }
        
        /* å°è¦½åˆ— */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: white; display: flex; border-top: 1px solid #eee; padding-bottom: env(safe-area-inset-bottom); z-index: 1000; }
        .nav-tab { flex: 1; border:none; background:none; color: #bbb; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.65rem; font-family: inherit; }
        .nav-tab.active { color: var(--blue); font-weight: bold; }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-height: 80vh; border-radius: 25px; padding: 25px; overflow-y: auto; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #eee; border-radius: 10px; font-size: 1rem; }
        .save-btn { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: 700; margin-top: 10px; }
        .cancel-btn { width: 100%; border: none; background: none; color: #aaa; margin-top: 10px; padding: 10px; }

        /* è¡Œç¨‹å…§å®¹ */
        .type-tag { font-size: 0.7rem; color: white; background: var(--accent); padding: 3px 8px; border-radius: 10px; }
        .addr-link { color: var(--blue); font-size: 0.85rem; text-decoration: underline; margin-top: 8px; display: inline-block; cursor: pointer; }
    </style>
</head>
<body>

<div class="banner">
    <div class="illustration">ğŸ„ğŸ‘©ğŸ»â€ğŸ¨ğŸ§‘ğŸ»â€ğŸ¨</div>
    <div style="font-size: 12px; color: #666;">Merry Christmas & Happy Birthday</div>
    <div class="banner-text">Carlos & Ivy</div>
</div>

<header id="tabTitle">Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ</header>

<div class="date-slider" id="dateSlider"></div>
<div class="container" id="mainView"></div>

<button class="fab" id="fabBtn" onclick="openModal()">
    <svg viewBox="0 0 24 24" width="28" height="28" stroke="white" stroke-width="3" fill="none"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
</button>

<nav class="bottom-nav">
    <button class="nav-tab active" onclick="goTab('trip')">è¡Œç¨‹</button>
    <button class="nav-tab" onclick="goTab('back')">å‚™æ¡ˆ</button>
    <button class="nav-tab" onclick="goTab('todo')">TODO</button>
    <button class="nav-tab" onclick="goTab('wallet')">è¨˜å¸³</button>
</nav>

<div id="modal" class="modal"><div class="modal-content" id="modalInner"></div></div>

<script>
    let day = 0, tab = 'trip';
    const store = (k, v) => v ? localStorage.setItem(k, JSON.stringify(v)) : JSON.parse(localStorage.getItem(k));
    
    let tripData = store('c_trip_final') || Array(8).fill().map(()=>[]);
    let backData = store('c_back') || []; // å‚™æ¡ˆ
    let todoData = store('c_todo') || [];
    let wallData = store('c_wall_all') || [];
    let rate = localStorage.getItem('c_rate') || 0.21;

    function goTab(t) { tab = t; render(); }

    function render() {
        const view = document.getElementById('mainView');
        const slider = document.getElementById('dateSlider');
        const title = document.getElementById('tabTitle');
        
        slider.style.display = (tab === 'trip') ? 'flex' : 'none';
        document.querySelectorAll('.nav-tab').forEach((n,i)=>n.classList.toggle('active', ['trip','back','todo','wallet'].indexOf(tab)===i));

        let h = '';
        if(tab === 'trip') {
            title.innerText = "Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ";
            slider.innerHTML = '';
            for(let i=0; i<8; i++){
                let d = new Date(2025, 11, 24+i);
                slider.innerHTML += `<button class="date-btn ${i===day?'active':''}" onclick="day=${i};render()"><span class="wk">${['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()]}</span><span>${d.getDate()}</span></button>`;
            }
            h = `<div id="drag-list">`;
            tripData[day].forEach((it, i) => {
                h += `<div class="card">
                    <button style="position:absolute;right:10px;top:10px;border:none;background:none;color:#ddd;" onclick="delTr(${i})">âœ•</button>
                    <span class="type-tag">${it.type}</span>
                    <div style="font-weight:700;margin-top:5px;">${it.title}</div>
                    <div style="font-size:0.8rem;color:#888;">ğŸ•’ ${it.time}</div>
                    ${it.addr ? `<div class="addr-link" onclick="goMap('${it.addr}')">ğŸ“ ${it.addr}</div>` : ''}
                </div>`;
            });
            h += `</div>`;
            view.innerHTML = h;
        } else if (tab === 'back') {
            title.innerText = "å‚™æ¡ˆå£è¢‹åå–®";
            h = `<h3>ğŸ’¡ å¯èƒ½æœƒæƒ³å»çš„åœ°æ–¹</h3>`;
            backData.forEach((it, i) => {
                h += `<div class="card">
                    <button style="position:absolute;right:10px;top:10px;border:none;background:none;color:#ddd;" onclick="backData.splice(${i},1);save();render()">âœ•</button>
                    <div style="font-weight:700;">${it.title}</div>
                    <div style="font-size:0.85rem;color:#666;">${it.note}</div>
                </div>`;
            });
            view.innerHTML = h;
        } else if (tab === 'todo') {
            title.innerText = "å¾…è¾¦äº‹é …";
            h = todoData.map((t,i)=> `<div class="card" style="display:flex;align-items:center;"><input type="checkbox" style="width:20px;height:20px;margin-right:10px;"> <span style="flex:1">${t}</span><button onclick="todoData.splice(${i},1);save();render()" style="border:none;background:none;color:#ccc;">âœ•</button></div>`).join('');
            view.innerHTML = h;
        } else if (tab === 'wallet') {
            title.innerText = "è¨˜å¸³èˆ‡çµ±è¨ˆ";
            h = `<div class="card">åŒ¯ç‡è¨­å®šï¼š<input type="number" step="0.001" value="${rate}" onchange="rate=this.value;save();render()" style="width:80px;padding:5px;"></div>`;
            wallData.forEach((w,i)=>{
                h += `<div class="card"><b>${w.name}</b> Â¥${w.amt} (NT$${(w.amt*rate).toFixed(0)}) <br><small>${w.date} | ${w.who} | ${w.pay}</small> <button onclick="wallData.splice(${i},1);save();render()" style="float:right;border:none;background:none;color:#ddd;">âœ•</button></div>`;
            });
            view.innerHTML = h;
        }
    }

    function openModal() {
        const inner = document.getElementById('modalInner');
        if(tab === 'trip') {
            inner.innerHTML = `<h3>æ–°å¢è¡Œç¨‹</h3><select id="m_type"><option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>ä½å®¿</option></select><input id="m_title" placeholder="åç¨±"><input type="time" id="m_time"><input id="m_addr" placeholder="åœ°å€"><button class="save-btn" onclick="addTr()">å„²å­˜</button><button class="cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>`;
        } else if(tab === 'back') {
            inner.innerHTML = `<h3>æ–°å¢å‚™æ¡ˆ</h3><input id="m_b_t" placeholder="åº—å/åœ°é»"><textarea id="m_b_n" placeholder="å‚™è¨»"></textarea><button class="save-btn" onclick="addBk()">å„²å­˜å‚™æ¡ˆ</button><button class="cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>`;
        } else if(tab === 'todo') {
            inner.innerHTML = `<h3>æ–°å¢ TODO</h3><input id="m_t_i"><button class="save-btn" onclick="addTd()">å„²å­˜</button><button class="cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>`;
        } else {
            inner.innerHTML = `<h3>æ–°å¢æ”¯å‡º</h3><input type="date" id="m_w_d"><input id="m_w_n" placeholder="å“é …"><input type="number" id="m_w_a" placeholder="æ—¥å¹£é‡‘é¡"><select id="m_w_p"><option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡</option></select><select id="m_w_w"><option>Carlos</option><option>Ivy</option></select><button class="save-btn" onclick="addWa()">å„²å­˜</button><button class="cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>`;
        }
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function addTr() { tripData[day].push({type:document.getElementById('m_type').value, title:document.getElementById('m_title').value, time:document.getElementById('m_time').value, addr:document.getElementById('m_addr').value}); save(); render(); closeModal(); }
    function addBk() { backData.push({title:document.getElementById('m_b_t').value, note:document.getElementById('m_b_n').value}); save(); render(); closeModal(); }
    function addTd() { todoData.push(document.getElementById('m_t_i').value); save(); render(); closeModal(); }
    function addWa() { wallData.push({date:document.getElementById('m_w_d').value, name:document.getElementById('m_w_n').value, amt:document.getElementById('m_w_a').value, pay:document.getElementById('m_w_p').value, who:document.getElementById('m_w_w').value}); save(); render(); closeModal(); }
    function delTr(i) { if(confirm('åˆªé™¤ï¼Ÿ')) { tripData[day].splice(i,1); save(); render(); } }
    function save() { store('c_trip_final', tripData); store('c_back', backData); store('c_todo', todoData); store('c_wall_all', wallData); localStorage.setItem('c_rate', rate); }
    
    function goMap(addr) {
        if(confirm('è¦é–‹å•Ÿ Google Maps å°èˆªå—ï¼Ÿ')) {
            window.location.href = `comgooglemaps://?q=${encodeURIComponent(addr)}`;
            setTimeout(() => { window.open(`www.google.com{encodeURIComponent(addr)}`); }, 500);
        }
    }

    render();
</script>
</body>
</html>
