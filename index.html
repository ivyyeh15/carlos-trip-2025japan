<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ</title>
    <!-- å¼•å…¥æ ¸å¿ƒç¾åŒ–å¥—ä»¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="cdn.jsdelivr.net"></script>
    <script src="unpkg.com"></script>
    <style>
        @import url('fonts.googleapis.com');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; -webkit-tap-highlight-color: transparent; }
        .morandi-purple { background-color: #9A94BC; }
        .morandi-blue { background-color: #A3B9C9; }
        /* éš±è—æœªè¼‰å…¥å‰çš„ç¨‹å¼ç¢¼ */
        [v-cloak] { display: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .nav-active { color: #9A94BC; transform: translateY(-3px); transition: all 0.3s; }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-[#F8F9FB] flex flex-col relative shadow-xl">
    
    <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡è³¼ç‰©è»Š -->
    <header class="bg-white p-5 sticky top-0 z-50 shadow-sm">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold text-[#7E749B]">Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ âœ¨</h1>
                <p class="text-[10px] text-gray-400">2025 Japan Travel | 8 Days</p>
            </div>
            <button @click="tab = 'shopping'" class="p-2 bg-gray-50 rounded-full text-[#9A94BC]">
                <i data-lucide="shopping-bag"></i>
            </button>
        </div>

        <!-- æ©«å‘æ—¥æœŸé¸æ“‡å™¨ -->
        <div v-if="tab === 'itinerary'" class="flex overflow-x-auto hide-scrollbar space-x-3 py-2">
            <div v-for="(day, index) in itinerary" :key="index"
                @click="currentDay = index"
                :class="['flex-shrink-0 w-14 h-16 rounded-2xl flex flex-col items-center justify-center border transition-all', 
                         currentDay === index ? 'morandi-purple text-white shadow-lg' : 'bg-white text-gray-400 border-gray-100']">
                <span class="text-[10px]">Day</span>
                <span class="text-sm font-bold">{{ index + 1 }}</span>
            </div>
        </div>
    </header>

    <!-- å…§å®¹å€åŸŸ -->
    <main class="flex-1 p-4 pb-24 overflow-y-auto">
        
        <!-- é¦–é ï¼šæ¦‚è¦½ -->
        <div v-if="tab === 'home'" class="space-y-4">
            <div class="morandi-purple p-6 rounded-3xl text-white shadow-md flex justify-between items-center">
                <div>
                    <p class="text-xs opacity-80">æ—¥æœ¬ç•¶åœ°å¤©æ°£</p>
                    <h2 class="text-3xl font-bold">8Â°C <span class="text-sm font-normal">æ™´ â„ï¸</span></h2>
                </div>
                <i data-lucide="sun-snow" class="w-10 h-10"></i>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-[#7E749B] mb-3 flex items-center gap-2"><i data-lucide="plane"></i> èˆªç­è³‡è¨Š</h3>
                <div class="flex gap-2">
                    <div class="flex-1 bg-gray-50 p-2 rounded-xl text-center"><p class="text-[10px] text-gray-400">å»ç¨‹</p><p class="font-bold">CI154</p></div>
                    <div class="flex-1 bg-gray-50 p-2 rounded-xl text-center"><p class="text-[10px] text-gray-400">å›ç¨‹</p><p class="font-bold">CI109</p></div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-[#7E749B] mb-3 flex items-center gap-2"><i data-lucide="hotel"></i> ä½å®¿åœ°é»</h3>
                <div class="space-y-2 text-xs">
                    <div class="p-2 bg-gray-50 rounded-lg"><b>12/24-28:</b> åå¤å±‹çš‡å®¶èŠ±åœ’æ¨™èªŒé£¯åº—</div>
                    <div class="p-2 bg-gray-50 rounded-lg"><b>12/28-31:</b> æ±äº¬é¾åé¤¨</div>
                </div>
            </div>
        </div>

        <!-- é ç±¤1ï¼šæ¯æ—¥è¡Œç¨‹ -->
        <div v-if="tab === 'itinerary'" class="space-y-3">
            <div v-for="(item, idx) in itinerary[currentDay].events" :key="idx" class="bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3">
                <div class="text-[#9A94BC] font-bold text-xs">{{ item.time }}</div>
                <div class="flex-1">
                    <span class="text-[10px] bg-[#F0EEF6] px-2 py-0.5 rounded-full text-[#9A94BC]">{{ item.type }}</span>
                    <p class="font-bold text-sm text-gray-700">{{ item.loc }}</p>
                    <p class="text-[10px] text-gray-400">{{ item.note }}</p>
                </div>
                <button @click="removeEvent(idx)" class="text-gray-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            <button @click="showModal = true" class="w-full py-4 border-2 border-dashed rounded-2xl text-gray-400 text-sm">+ æ–°å¢è¡Œç¨‹</button>
        </div>

        <!-- é ç±¤2ï¼šè¨˜å¸³åŠŸèƒ½ -->
        <div v-if="tab === 'expenses'" class="space-y-4">
            <div class="morandi-blue p-6 rounded-3xl text-white text-center">
                <p class="text-xs opacity-80">æ—…è¡Œç¸½æ”¯å‡º (TWD)</p>
                <h2 class="text-3xl font-bold">NT$ {{ totalTWD }}</h2>
            </div>
            <div class="space-y-2">
                <div v-for="(e, i) in expenses" :key="i" class="bg-white p-3 rounded-xl flex justify-between items-center">
                    <div>
                        <p class="text-sm font-bold">{{ e.name }}</p>
                        <p class="text-[10px] text-gray-400">{{ e.amount }} {{ e.currency }} â‰ˆ NT$ {{ conv(e) }}</p>
                    </div>
                    <button @click="expenses.splice(i, 1)" class="text-gray-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-md border-2 border-[#A3B9C9]">
                <input v-model="newExp.name" placeholder="æ¶ˆè²»é …ç›®" class="w-full mb-2 p-2 border-b outline-none text-sm">
                <div class="flex gap-2">
                    <input v-model.number="newExp.amount" type="number" placeholder="é‡‘é¡" class="flex-1 p-2 border-b outline-none text-sm">
                    <select v-model="newExp.currency" class="border-b text-sm"><option value="JPY">æ—¥åœ“</option><option value="TWD">å°å¹£</option></select>
                </div>
                <button @click="addExp" class="w-full mt-4 morandi-blue text-white py-2 rounded-xl text-sm">æ–°å¢æ”¯å‡º</button>
            </div>
        </div>

        <!-- é ç±¤3ï¼šå‚™ç”¨æ™¯é» -->
        <div v-if="tab === 'places'" class="space-y-3">
            <div v-for="(p, i) in places" :key="i" class="bg-white p-3 rounded-xl flex items-center gap-3">
                <input type="checkbox" v-model="p.done">
                <p class="flex-1 text-sm" :class="{'line-through text-gray-300': p.done}">{{ p.name }}</p>
                <button @click="places.splice(i, 1)" class="text-gray-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            <div class="flex gap-2">
                <input v-model="newPlace" placeholder="æ–°æ™¯é»..." class="flex-1 p-2 bg-white rounded-lg text-sm outline-none">
                <button @click="addPlace" class="bg-gray-400 text-white px-4 rounded-lg text-sm">åŠ </button>
            </div>
        </div>

        <!-- é ç±¤4ï¼šTODO -->
        <div v-if="tab === 'todo'" class="space-y-2">
            <div v-for="(t, i) in todos" :key="i" class="bg-white p-3 rounded-xl flex items-center gap-3">
                <input type="checkbox" v-model="t.done">
                <span class="text-sm" :class="{'line-through text-gray-300': t.done}">{{ t.text }}</span>
                <button @click="todos.splice(i, 1)" class="ml-auto text-gray-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
            <button @click="todos.push({text: 'æ–°å¾…è¾¦äº‹é …', done: false})" class="text-[#9A94BC] text-sm font-bold">+ æ–°å¢äº‹é …</button>
        </div>

        <!-- è³¼ç‰©æ¸…å–® -->
        <div v-if="tab === 'shopping'" class="space-y-3">
            <h3 class="font-bold text-[#7E749B]">ğŸ›ï¸ è³¼ç‰©æ¸…å–®</h3>
            <div v-for="(s, i) in shopping" :key="i" class="bg-white p-3 rounded-xl flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <input type="checkbox" v-model="s.done">
                    <span :class="{'line-through text-gray-300': s.done}" class="text-sm">{{ s.name }}</span>
                </div>
                <button @click="shopping.splice(i, 1)" class="text-gray-200"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="flex gap-2">
                <input v-model="newShop" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="flex-1 p-2 bg-gray-100 rounded-lg text-sm outline-none">
                <button @click="addShop" class="morandi-blue text-white px-4 rounded-lg text-sm">æ–°å¢</button>
            </div>
        </div>

    </main>

    <!-- æ–°å¢è¡Œç¨‹å½ˆçª— -->
    <div v-if="showModal" class="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-6">
        <div class="bg-white w-full rounded-3xl p-6">
            <h3 class="font-bold mb-4">æ–°å¢ D{{currentDay+1}} è¡Œç¨‹</h3>
            <div class="space-y-3">
                <input v-model="newEv.time" type="time" class="w-full p-2 bg-gray-50 rounded-lg outline-none">
                <select v-model="newEv.type" class="w-full p-2 bg-gray-50 rounded-lg outline-none">
                    <option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>äº¤é€š</option><option>èˆªç­</option><option>è³¼ç‰©</option><option>å…¶ä»–</option>
                </select>
                <input v-model="newEv.loc" placeholder="åœ°é»" class="w-full p-2 bg-gray-50 rounded-lg outline-none">
                <input v-model="newEv.note" placeholder="å‚™è¨»" class="w-full p-2 bg-gray-50 rounded-lg outline-none">
                <div class="flex gap-2 pt-2">
                    <button @click="showModal = false" class="flex-1 py-2 bg-gray-100 rounded-lg">å–æ¶ˆ</button>
                    <button @click="addEvent" class="flex-1 py-2 morandi-purple text-white rounded-lg">ç¢ºå®š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª (æ‰‹ç¹ª Icon) -->
    <nav class="fixed bottom-0 w-full max-w-md bg-white border-t flex justify-around py-4 shadow-lg rounded-t-3xl">
        <button @click="tab = 'home'" :class="{'nav-active': tab === 'home'}"><i data-lucide="home"></i></button>
        <button @click="tab = 'itinerary'" :class="{'nav-active': tab === 'itinerary'}"><i data-lucide="calendar"></i></button>
        <button @click="tab = 'expenses'" :class="{'nav-active': tab === 'expenses'}"><i data-lucide="banknote"></i></button>
        <button @click="tab = 'places'" :class="{'nav-active': tab === 'places'}"><i data-lucide="map-pin"></i></button>
        <button @click="tab = 'todo'" :class="{'nav-active': tab === 'todo'}"><i data-lucide="list-checks"></i></button>
    </nav>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        tab: 'home',
        currentDay: 0,
        showModal: false,
        itinerary: [],
        expenses: [],
        places: [],
        todos: [],
        shopping: [],
        newEv: { time: '09:00', type: 'æ™¯é»', loc: '', note: '' },
        newExp: { name: '', amount: null, currency: 'JPY' },
        newPlace: '',
        newShop: ''
    },
    computed: {
        totalTWD() {
            let total = this.expenses.reduce((sum, e) => sum + this.conv(e), 0);
            return total.toLocaleString();
        }
    },
    methods: {
        conv(e) {
            return e.currency === 'TWD' ? e.amount : Math.round(e.amount * 0.21);
        },
        addEvent() {
            if(!this.newEv.loc) return;
            this.itinerary[this.currentDay].events.push({...this.newEv});
            this.itinerary[this.currentDay].events.sort((a,b) => a.time.localeCompare(b.time));
            this.showModal = false;
            this.newEv = { time: '09:00', type: 'æ™¯é»', loc: '', note: '' };
            this.$nextTick(() => lucide.createIcons());
        },
        removeEvent(idx) { this.itinerary[this.currentDay].events.splice(idx, 1); },
        addExp() {
            if(!this.newExp.name || !this.newExp.amount) return;
            this.expenses.push({...this.newExp});
            this.newExp = { name: '', amount: null, currency: 'JPY' };
        },
        addPlace() {
            if(!this.newPlace) return;
            this.places.push({ name: this.newPlace, done: false });
            this.newPlace = '';
            this.$nextTick(() => lucide.createIcons());
        },
        addShop() {
            if(!this.newShop) return;
            this.shopping.push({ name: this.newShop, done: false });
            this.newShop = '';
            this.$nextTick(() => lucide.createIcons());
        },
        save() {
            const data = { it: this.itinerary, ex: this.expenses, pl: this.places, td: this.todos, sh: this.shopping };
            localStorage.setItem('carlos_travel_v1', JSON.stringify(data));
        }
    },
    watch: {
        tab() { this.$nextTick(() => lucide.createIcons()); },
        itinerary: { deep: true, handler() { this.save(); } },
        expenses: { deep: true, handler() { this.save(); } },
        places: { deep: true, handler() { this.save(); } },
        todos: { deep: true, handler() { this.save(); } },
        shopping: { deep: true, handler() { this.save(); } }
    },
    mounted() {
        const saved = localStorage.getItem('carlos_travel_v1');
        if(saved) {
            const d = JSON.parse(saved);
            this.itinerary = d.it;
            this.expenses = d.ex;
            this.places = d.pl;
            this.todos = d.td;
            this.shopping = d.sh;
        } else {
            for(let i=0; i<8; i++) this.itinerary.push({ events: [] });
        }
        lucide.createIcons();
    }
});
</script>
</body>
</html>
