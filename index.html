<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ - æ—…éŠå°å¹«æ‰‹</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="unpkg.com"></script>
    <!-- Lucide Icons (æ‰‹ç¹ªæ„Ÿåœ–ç¤º) -->
    <script src="unpkg.com"></script>
    <!-- SortableJS (æ‹–æ‹½åŠŸèƒ½) -->
    <script src="cdn.jsdelivr.net"></script>
    <!-- vuedraggable -->
    <script src="cdnjs.cloudflare.com"></script>

    <style>
        @import url('fonts.googleapis.com');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F0F2F5;
            color: #4A4E69;
            -webkit-tap-highlight-color: transparent;
        }

        /* è«è˜­è¿ªè—ç´«è‰²ç³» */
        .bg-morandi-blue { background-color: #9AADC4; }
        .bg-morandi-purple { background-color: #B9B7BD; }
        .text-morandi-deep { color: #4A4E69; }
        .accent-color { background-color: #8E94F2; }

        /* æ—¥ç³»ç°¡ç´„é™°å½± */
        .soft-shadow {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* åº•éƒ¨å°è¦½åˆ— */
        .tab-bar {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* æ—¥æœŸæ»‘å‹• */
        .date-chip.active {
            background-color: #8E94F2;
            color: white;
            transform: scale(1.05);
        }

        .category-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
    </style>
</head>
<body class="max-w-md mx-auto bg-slate-50 min-h-screen pb-24">

<div id="app" v-cloak>
    <!-- é ‚éƒ¨æ¨™é¡Œå€ -->
    <header class="p-6 bg-white rounded-b-3xl shadow-sm">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold text-morandi-deep">Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ ğŸŒŸ</h1>
                <p class="text-xs text-gray-400">8 Days Adventure in Japan</p>
            </div>
            <button @click="currentTab = 'shopping'" class="p-2 bg-purple-50 rounded-full text-purple-400 relative">
                <i data-lucide="shopping-bag"></i>
                <span v-if="shoppingList.length > 0" class="absolute top-0 right-0 w-2 h-2 bg-red-400 rounded-full"></span>
            </button>
        </div>

        <!-- èˆªç­èˆ‡ä½å®¿å¡ç‰‡ (é¦–é é¡¯ç¤º) -->
        <div v-if="currentTab === 'home'" class="space-y-3">
            <div class="bg-blue-50 p-3 rounded-2xl flex items-center">
                <i data-lucide="plane" class="text-blue-400 mr-3"></i>
                <div class="text-sm">
                    <p class="font-medium">èˆªç­è³‡è¨Š</p>
                    <p class="text-xs text-gray-500">å»ç¨‹ CI154 | å›ç¨‹ CI109</p>
                </div>
            </div>
            <div class="bg-purple-50 p-3 rounded-2xl flex items-center">
                <i data-lucide="hotel" class="text-purple-400 mr-3"></i>
                <div class="text-sm">
                    <p class="font-medium">ä½å®¿: åå¤å±‹ / æ±äº¬</p>
                    <p class="text-xs text-gray-500 truncate w-56">12/24-12/31 çš‡å®¶èŠ±åœ’ & é¾åé¤¨</p>
                </div>
            </div>
        </div>
    </header>

    <!-- å…§å®¹å€åŸŸ -->
    <main class="p-4">
        
        <!-- é ç±¤1: æ¯æ—¥è¡Œç¨‹ -->
        <section v-if="currentTab === 'home'">
            <!-- æ©«å‘æ—¥æœŸé¸æ“‡å™¨ -->
            <div class="flex overflow-x-auto no-scrollbar py-4 space-x-3">
                <div v-for="n in 8" :key="n" 
                     @click="activeDay = n"
                     :class="['date-chip flex-shrink-0 w-14 h-16 rounded-2xl flex flex-col items-center justify-center transition-all cursor-pointer', activeDay === n ? 'bg-indigo-400 text-white shadow-lg' : 'bg-white text-gray-400']">
                    <span class="text-[10px]">DAY</span>
                    <span class="text-lg font-bold">{{ n }}</span>
                </div>
            </div>

            <!-- ç•¶æ—¥å¤©æ°£é æ¸¬ (æ¨¡æ“¬) -->
            <div class="bg-white/60 backdrop-blur-md p-3 rounded-xl mb-4 flex justify-between items-center border border-white">
                <div class="flex items-center">
                    <i data-lucide="cloud-sun" class="text-yellow-500 mr-2"></i>
                    <span class="text-sm font-medium">åå¤å±‹ / æ±äº¬ ç•¶åœ°æ°£æº«</span>
                </div>
                <span class="text-sm font-bold text-indigo-500">4Â°C ~ 11Â°C</span>
            </div>

            <!-- è¡Œç¨‹åˆ—è¡¨ (Draggable) -->
            <draggable v-model="itinerary[activeDay]" item-key="id" handle=".drag-handle">
                <template #item="{element, index}">
                    <div class="bg-white p-4 rounded-2xl mb-3 soft-shadow relative group">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center">
                                <span :class="['category-dot', getCategoryColor(element.type)]"></span>
                                <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded-full text-gray-500">{{ element.type }}</span>
                                <span class="ml-2 text-sm font-bold text-gray-600">{{ element.time }}</span>
                            </div>
                            <div class="flex space-x-2">
                                <i class="drag-handle cursor-move text-gray-300" data-lucide="grip-vertical" size="16"></i>
                                <button @click="deleteItem(activeDay, index)"><i data-lucide="trash-2" class="text-red-300" size="16"></i></button>
                            </div>
                        </div>
                        <h3 class="font-medium text-gray-800">{{ element.location }}</h3>
                        <p v-if="element.note" class="text-xs text-gray-400 mt-2 border-t pt-2">{{ element.note }}</p>
                    </div>
                </template>
            </draggable>

            <!-- æ–°å¢æŒ‰éˆ• -->
            <button @click="showAddModal = true" class="w-full py-4 border-2 border-dashed border-gray-300 rounded-2xl text-gray-400 flex justify-center items-center">
                <i data-lucide="plus" class="mr-1"></i> æ–°å¢è¡Œç¨‹é …ç›®
            </button>
        </section>

        <!-- é ç±¤2: åˆ†å¸³åŠŸèƒ½ -->
        <section v-if="currentTab === 'expense'">
            <div class="bg-white p-6 rounded-3xl mb-6">
                <p class="text-center text-sm text-gray-400 mb-1">æœ¬æ¬¡æ—…è¡Œç¸½èŠ±è²» (TWD)</p>
                <h2 class="text-center text-3xl font-bold text-indigo-600">NT$ {{ totalExpense }}</h2>
                <div class="flex justify-center mt-4 space-x-4">
                    <div class="text-center">
                        <p class="text-[10px] text-gray-400 uppercase">åŒ¯ç‡åƒè€ƒ</p>
                        <p class="text-sm font-medium">1 JPY = 0.21 TWD</p>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="font-bold">é–‹æ”¯æ˜ç´°</h3>
                    <button @click="addExpense" class="text-xs bg-indigo-500 text-white px-3 py-1 rounded-full">+ è¨˜å¸³</button>
                </div>
                <div v-for="(exp, idx) in expenses" :key="idx" class="bg-white p-4 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-orange-50 rounded-full flex items-center justify-center mr-3 text-orange-400">
                            <i data-lucide="receipt"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium">{{ exp.title }}</p>
                            <p class="text-[10px] text-gray-400">Day {{ exp.day }} Â· {{ exp.currency === 'JPY' ? exp.amount + ' JPY' : 'TWD' }}</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-gray-700 mr-4">â‰ˆ ${{ Math.round(exp.currency === 'JPY' ? exp.amount * 0.21 : exp.amount) }}</span>
                        <button @click="expenses.splice(idx, 1)"><i data-lucide="trash-2" class="text-red-200" size="18"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- é ç±¤3: å‚™ç”¨æ™¯é» -->
        <section v-if="currentTab === 'spots'">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">å£è¢‹åå–®</h3>
                <button @click="addSpot" class="p-2 bg-white rounded-full text-indigo-400 shadow-sm"><i data-lucide="plus"></i></button>
            </div>
            <div class="grid grid-cols-1 gap-3">
                <div v-for="(spot, idx) in spots" :key="idx" class="bg-white p-4 rounded-2xl flex items-center space-x-3">
                    <input type="checkbox" v-model="spot.checked" class="w-5 h-5 rounded-full border-gray-300 text-indigo-500">
                    <div class="flex-1">
                        <p :class="['text-sm font-medium', spot.checked ? 'line-through text-gray-300' : '']">{{ spot.name }}</p>
                        <p class="text-[10px] text-gray-400">{{ spot.location }}</p>
                    </div>
                    <button @click="spots.splice(idx, 1)"><i data-lucide="x" class="text-gray-300" size="16"></i></button>
                </div>
            </div>
        </section>

        <!-- é ç±¤4: TODO -->
        <section v-if="currentTab === 'todo'">
            <h3 class="font-bold text-lg mb-4">è¡Œå‰æ¸…å–®</h3>
            <div class="bg-white rounded-3xl p-4 shadow-sm">
                <div class="flex mb-4">
                    <input v-model="newTodo" @keyup.enter="addTodo" type="text" placeholder="éœ€è¦åšä»€éº¼ï¼Ÿ" class="flex-1 bg-gray-50 border-none rounded-l-xl p-3 text-sm focus:ring-0">
                    <button @click="addTodo" class="bg-indigo-400 text-white px-4 rounded-r-xl"><i data-lucide="plus"></i></button>
                </div>
                <div v-for="(item, idx) in todos" :key="idx" class="flex items-center py-3 border-b border-gray-50 last:border-0">
                    <input type="checkbox" v-model="item.done" class="mr-3">
                    <span :class="['text-sm flex-1', item.done ? 'line-through text-gray-300' : '']">{{ item.text }}</span>
                    <button @click="todos.splice(idx, 1)"><i data-lucide="trash" size="14" class="text-gray-300"></i></button>
                </div>
            </div>
        </section>

        <!-- è³¼ç‰©æ¸…å–® (éš±è—é é¢) -->
        <section v-if="currentTab === 'shopping'">
            <div class="flex items-center mb-6">
                <button @click="currentTab = 'home'" class="mr-3"><i data-lucide="chevron-left"></i></button>
                <h3 class="font-bold text-lg">æƒ³è¦è²·çš„æ±è¥¿</h3>
            </div>
            <div class="space-y-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white p-4 rounded-2xl flex justify-between items-center">
                    <span class="text-sm">{{ item }}</span>
                    <button @click="shoppingList.splice(idx, 1)"><i data-lucide="trash-2" class="text-red-200" size="18"></i></button>
                </div>
                <button @click="addItemPrompt('shoppingList')" class="w-full py-3 bg-white border-2 border-dashed rounded-2xl text-gray-400 text-sm">
                    + æ–°å¢å•†å“
                </button>
            </div>
        </section>

    </main>

    <!-- åº•éƒ¨å°èˆªæ¬„ -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-100 flex justify-around items-center py-3 tab-bar max-w-md mx-auto">
        <button @click="currentTab = 'home'" :class="currentTab === 'home' ? 'text-indigo-500' : 'text-gray-300'">
            <i data-lucide="calendar-days"></i>
        </button>
        <button @click="currentTab = 'expense'" :class="currentTab === 'expense' ? 'text-indigo-500' : 'text-gray-300'">
            <i data-lucide="wallet"></i>
        </button>
        <button @click="currentTab = 'spots'" :class="currentTab === 'spots' ? 'text-indigo-500' : 'text-gray-300'">
            <i data-lucide="map-pin"></i>
        </button>
        <button @click="currentTab = 'todo'" :class="currentTab === 'todo' ? 'text-indigo-500' : 'text-gray-300'">
            <i data-lucide="check-square"></i>
        </button>
        <a href="www.google.com" target="_blank" class="text-gray-300">
            <i data-lucide="map"></i>
        </a>
    </nav>

    <!-- æ–°å¢è¡Œç¨‹ Modal -->
    <div v-if="showAddModal" class="fixed inset-0 bg-black/50 flex items-end z-50">
        <div class="bg-white w-full rounded-t-3xl p-6 animate-slide-up">
            <h3 class="font-bold mb-4">æ–°å¢è¡Œç¨‹</h3>
            <div class="space-y-3">
                <select v-model="newItem.type" class="w-full p-3 bg-gray-50 rounded-xl border-none text-sm">
                    <option>æ™¯é»</option><option>äº¤é€š</option><option>èˆªç­</option><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>å…¶ä»–</option>
                </select>
                <input v-model="newItem.time" type="time" class="w-full p-3 bg-gray-50 rounded-xl border-none text-sm">
                <input v-model="newItem.location" type="text" placeholder="åœ°é»åç¨±" class="w-full p-3 bg-gray-50 rounded-xl border-none text-sm">
                <textarea v-model="newItem.note" placeholder="å‚™è¨»å…§å®¹" class="w-full p-3 bg-gray-50 rounded-xl border-none text-sm"></textarea>
                <div class="flex space-x-3 mt-4">
                    <button @click="showAddModal = false" class="flex-1 py-3 bg-gray-100 rounded-xl text-gray-500">å–æ¶ˆ</button>
                    <button @click="saveItem" class="flex-1 py-3 bg-indigo-500 rounded-xl text-white">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        components: {
            draggable: window.vuedraggable
        },
        setup() {
            const currentTab = ref('home');
            const activeDay = ref(1);
            const showAddModal = ref(false);
            
            // è³‡æ–™ç‹€æ…‹
            const itinerary = ref(JSON.parse(localStorage.getItem('carlos_itinerary')) || {
                1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [], 8: []
            });
            const expenses = ref(JSON.parse(localStorage.getItem('carlos_expenses')) || []);
            const spots = ref(JSON.parse(localStorage.getItem('carlos_spots')) || []);
            const todos = ref(JSON.parse(localStorage.getItem('carlos_todos')) || []);
            const shoppingList = ref(JSON.parse(localStorage.getItem('carlos_shopping')) || []);

            const newItem = ref({ type: 'æ™¯é»', time: '10:00', location: '', note: '' });
            const newTodo = ref('');

            // è¨ˆç®—ç¸½é¡ (JPY 0.21 åŒ¯ç‡)
            const totalExpense = computed(() => {
                return expenses.value.reduce((sum, item) => {
                    const val = item.currency === 'JPY' ? item.amount * 0.21 : item.amount;
                    return sum + Number(val);
                }, 0).toLocaleString();
            });

            // æ–¹æ³•
            const saveItem = () => {
                if(!newItem.value.location) return;
                itinerary.value[activeDay.value].push({ ...newItem.value, id: Date.now() });
                showAddModal.value = false;
                newItem.value = { type: 'æ™¯é»', time: '10:00', location: '', note: '' };
                refreshIcons();
            };

            const deleteItem = (day, index) => {
                itinerary.value[day].splice(index, 1);
            };

            const addExpense = () => {
                const title = prompt("æ”¯å‡ºåç¨±:");
                const amount = prompt("é‡‘é¡:");
                const currency = confirm("é»æ“Šã€ç¢ºå®šã€ç‚ºæ—¥å¹£(JPY)ï¼Œã€å–æ¶ˆã€ç‚ºå°å¹£(TWD)") ? 'JPY' : 'TWD';
                if(title && amount) {
                    expenses.value.push({ title, amount, currency, day: activeDay.value });
                }
            };

            const addSpot = () => {
                const name = prompt("æ™¯é»åç¨±:");
                const location = prompt("å¤§ç•¥ä½ç½®:");
                if(name) spots.value.push({ name, location, checked: false });
                refreshIcons();
            };

            const addTodo = () => {
                if(newTodo.value) {
                    todos.value.push({ text: newTodo.value, done: false });
                    newTodo.value = '';
                }
            };

            const addItemPrompt = (listName) => {
                const item = prompt("è¼¸å…¥å…§å®¹:");
                if(item) {
                    if(listName === 'shoppingList') shoppingList.value.push(item);
                }
            };

            const getCategoryColor = (type) => {
                const colors = { 'æ™¯é»': 'bg-green-400', 'äº¤é€š': 'bg-blue-400', 'èˆªç­': 'bg-indigo-400', 'ç¾é£Ÿ': 'bg-orange-400', 'è³¼ç‰©': 'bg-pink-400', 'å…¶ä»–': 'bg-gray-400' };
                return colors[type] || 'bg-gray-400';
            };

            const refreshIcons = () => {
                setTimeout(() => lucide.createIcons(), 10);
            };

            // ç›£è½ä¸¦ä¿å­˜è‡³ LocalStorage
            watch([itinerary, expenses, spots, todos, shoppingList], () => {
                localStorage.setItem('carlos_itinerary', JSON.stringify(itinerary.value));
                localStorage.setItem('carlos_expenses', JSON.stringify(expenses.value));
                localStorage.setItem('carlos_spots', JSON.stringify(spots.value));
                localStorage.setItem('carlos_todos', JSON.stringify(todos.value));
                localStorage.setItem('carlos_shopping', JSON.stringify(shoppingList.value));
                refreshIcons();
            }, { deep: true });

            onMounted(() => {
                refreshIcons();
            });

            return {
                currentTab, activeDay, itinerary, expenses, spots, todos, shoppingList,
                showAddModal, newItem, newTodo, totalExpense,
                saveItem, deleteItem, addExpense, addSpot, addTodo, addItemPrompt, getCategoryColor
            };
        }
    }).mount('#app');
</script>

<style>
    @keyframes slide-up {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }
    .animate-slide-up {
        animation: slide-up 0.3s ease-out;
    }
    [v-cloak] { display: none; }
</style>

</body>
</html>
