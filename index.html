<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="fonts.googleapis.com" rel="stylesheet">
    <script src="cdn.jsdelivr.net"></script>
    <style>
        :root { --blue: #94a7ae; --gray: #e2e2e2; --bg: #f8f9fa; --text: #4a4a4a; --accent: #c5a48e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; }
        
        header { background: var(--blue); color: white; padding: 55px 20px 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .date-slider { display: flex; overflow-x: auto; background: white; padding: 12px; gap: 12px; border-bottom: 1px solid var(--gray); scrollbar-width: none; position: sticky; top: 90px; z-index: 90; }
        .date-slider::-webkit-scrollbar { display: none; }
        .date-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 65px; height: 75px; border-radius: 18px; background: #f2f2f2; border: none; flex-shrink: 0; }
        .date-btn .wk { font-size: 1.1rem; font-weight: 700; color: #888; }
        .date-btn .dt { font-size: 0.8rem; color: #aaa; }
        .date-btn.active { background: var(--blue); }
        .date-btn.active .wk, .date-btn.active .dt { color: white; }

        .container { padding: 15px; }
        
        /* å¤©æ°£å€åŸŸ */
        .weather-info { background: white; border-radius: 18px; padding: 15px; margin-bottom: 18px; display: flex; align-items: center; gap: 15px; border: 1px solid #eee; cursor: pointer; }
        .weather-icon { font-size: 2.2rem; }
        .city-tag { font-size: 0.7rem; background: var(--blue); color: white; padding: 2px 6px; border-radius: 5px; margin-bottom: 3px; display: inline-block; }

        /* è¡Œç¨‹å¡ç‰‡ */
        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; border: 1px solid #efefef; }
        .type-tag { font-size: 0.7rem; color: white; background: var(--accent); padding: 4px 12px; border-radius: 12px; margin-bottom: 8px; display: inline-block; }
        .addr-text { font-size: 0.85rem; color: var(--blue); margin-top: 10px; display: flex; align-items: center; gap: 5px; text-decoration: underline; font-weight: 500; }

        /* èˆªç­å¡ç‰‡ */
        .flight-card { background: linear-gradient(135deg, #4a6a75 0%, #94a7ae 100%); color: white; border-radius: 20px; padding: 22px; margin-bottom: 15px; box-shadow: 0 6px 20px rgba(148, 167, 174, 0.3); }

        .fab { position: fixed; bottom: 95px; right: 25px; width: 65px; height: 65px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(0,0,0,0.2); border: none; z-index: 500; }
        .fab svg { width: 32px; height: 32px; stroke: white; stroke-width: 3; }

        /* Modal ä¿®æ­£ */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 92%; max-height: 85vh; border-radius: 30px; padding: 28px; overflow-y: auto; }
        label { font-size: 0.85rem; color: #888; margin-top: 15px; display: block; padding-left: 5px; }
        input, select, textarea { width: 100%; height: 50px; padding: 12px; margin-top: 5px; border: 1px solid #eee; border-radius: 12px; font-family: inherit; font-size: 1rem; background: #fafafa; display: block; }
        textarea { height: auto; }
        .save-btn { background: var(--blue); color: white; border: none; padding: 18px; border-radius: 15px; width: 100%; margin-top: 25px; font-weight: 700; font-size: 1.1rem; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); display: flex; border-top: 1px solid #eee; padding-bottom: env(safe-area-inset-bottom); z-index: 1000; }
        .nav-tab { flex: 1; border:none; background:none; color: #bbb; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.75rem; font-family: inherit; }
        .nav-tab.active { color: var(--blue); font-weight: bold; }
    </style>
</head>
<body>

<header><h1 style="font-size:1.2rem; letter-spacing:2px; margin:0; font-weight:700;">Carlos ç”Ÿæ—¥æ‘˜æ˜Ÿæ˜Ÿ</h1></header>

<div class="date-slider" id="dateSlider"></div>
<div class="container" id="mainView"></div>

<button class="fab" onclick="openModal()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
</button>

<nav class="bottom-nav">
    <button class="nav-tab active" onclick="goTab('trip')">è¡Œç¨‹</button>
    <button class="nav-tab" onclick="goTab('todo')">TODO</button>
    <button class="nav-tab" onclick="goTab('wallet')">è¨˜å¸³</button>
</nav>

<div id="modal" class="modal"><div class="modal-content" id="modalInner"></div></div>

<script>
    let dayIdx = 0, tab = 'trip', editIdx = null;
    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const store = (k, v) => v ? localStorage.setItem(k, JSON.stringify(v)) : JSON.parse(localStorage.getItem(k));
    
    let tripData = store('c_trip_2025_star') || Array(8).fill().map(()=>[]);
    let todoData = store('c_todo') || [];
    let wallData = store('c_wall_global') || [];

    const save = () => { store('c_trip_2025_star', tripData); store('c_todo', todoData); store('c_wall_global', wallData); };

    function goTab(t) { tab = t; render(); }

    function render() {
        const view = document.getElementById('mainView');
        const slider = document.getElementById('dateSlider');
        slider.style.display = (tab === 'trip') ? 'flex' : 'none';
        
        if(tab === 'trip') {
            slider.innerHTML = '';
            for(let i=0; i<8; i++) {
                let d = new Date(2025, 11, 24 + i);
                slider.innerHTML += `
                <button class="date-btn ${i===dayIdx?'active':''}" onclick="dayIdx=${i};render()">
                    <span class="wk">${weekdays[d.getDay()]}</span>
                    <span class="dt">${d.getDate()}</span>
                </button>`;
            }
        }

        document.querySelectorAll('.nav-tab').forEach((n,i)=>n.classList.toggle('active', ['trip','todo','wallet'].indexOf(tab)===i));

        let h = '';
        if(tab === 'trip') {
            // å¤©æ°£èˆ‡åœ°å€é€£å‹•
            let isTokyo = dayIdx >= 4; // 12/28 æ˜¯ç´¢å¼• 4
            let city = isTokyo ? 'æ±äº¬ Tokyo' : 'åå¤å±‹ Nagoya';
            let weatherUrl = isTokyo ? 'weather.yahoo.co.jp' : 'weather.yahoo.co.jp';
            
            h += `<div class="weather-info" onclick="window.open('${weatherUrl}')">
                    <span class="weather-icon">â„ï¸</span>
                    <div>
                        <span class="city-tag">${city}</span>
                        <div style="font-weight:700">é ä¼° 3Â°C ~ 10Â°C</div>
                        <div style="font-size:0.8rem;color:#888;">é»æ“ŠæŸ¥çœ‹ Yahoo æ—¥æœ¬æ°£è±¡è©³ç´°é å ±</div>
                    </div>
                  </div>`;
            
            if(dayIdx === 0) {
                h += `
                <div class="flight-card" onclick="openGMap('æ¡ƒåœ’åœ‹éš›æ©Ÿå ´')">
                    <div style="font-size:0.8rem; opacity:0.8; margin-bottom:5px;">è¯èˆª CI154 | 12/24 DEPARTURE</div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:1.8rem; font-weight:700;">TPE</span>
                        <span style="font-size:1.2rem;">âœˆï¸</span>
                        <span style="font-size:1.8rem; font-weight:700;">NGO</span>
                    </div>
                    <div style="font-size:0.95rem; margin-top:10px; font-weight:500;">07:35 èµ·é£› - 11:05 æŠµé” (2.5hr)</div>
                </div>`;
            }

            h += `<div id="drag-list">`;
            tripData[dayIdx].forEach((it, i) => {
                h += `
                <div class="card">
                    <button style="position:absolute;right:15px;top:15px;border:none;background:none;color:#ddd;padding:5px;" onclick="event.stopPropagation();openEdit(${i})">Edit</button>
                    <span class="type-tag">${it.type}</span>
                    <div style="font-weight:700; font-size:1.2rem; color:var(--text);">${it.title}</div>
                    <div style="font-size:0.9rem; color:#888; margin-top:8px;">ğŸ•’ æŠµé”: ${it.time || '--:--'} | ç‡Ÿæ¥­: ${it.hours || 'è¦‹å®˜ç¶²'}</div>
                    ${it.ticket ? `<div style="font-size:0.85rem; color:var(--accent); font-weight:700; margin-top:5px;">ğŸŸï¸ é–€ç¥¨: ${it.ticket}</div>` : ''}
                    ${it.addr ? `<div class="addr-text" onclick="openGMap('${it.addr}')">ğŸ“ ${it.addr}</div>` : ''}
                    ${it.note ? `<div style="font-size:0.9rem; color:#666; margin-top:12px; border-top:1px dashed #eee; padding-top:12px; white-space:pre-line; line-height:1.5;">âœ¨ ${it.note}</div>` : ''}
                </div>`;
            });
            h += `</div>`;
            view.innerHTML = h;
            if(document.getElementById('drag-list')) {
                new Sortable(document.getElementById('drag-list'), { animation: 150, onEnd: (e) => {
                    let items = tripData[dayIdx];
                    let [moved] = items.splice(e.oldIndex, 1);
                    items.splice(e.newIndex, 0, moved);
                    save(); render();
                }});
            }
        } else {
            view.innerHTML = `<p style="text-align:center; padding:100px 20px; color:#ccc; font-size:0.9rem;">TODO èˆ‡ è¨˜å¸³é é¢ç¶­æŒåŸæ¨£<br>è«‹ç”±æ­¤è™•åˆ‡æ›è‡³è¡Œç¨‹é é¢æ¸¬è©¦</p>`;
        }
    }

    function openGMap(address) {
        // ä½¿ç”¨ comgooglemaps:// å–šèµ· Appï¼Œè‹¥å¤±æ•—å‰‡å›é€€åˆ° https é€£çµ
        const url = `comgooglemaps://?q=${encodeURIComponent(address)}`;
        window.location.href = url;
        setTimeout(() => {
            window.open(`www.google.com{encodeURIComponent(address)}`);
        }, 500);
    }

    function openModal() {
        editIdx = null;
        const inner = document.getElementById('modalInner');
        inner.innerHTML = `
            <h3 style="margin:0 0 10px; color:var(--blue);">æ–°å¢è¡Œç¨‹é …ç›®</h3>
            <label>è¡Œç¨‹åˆ†é¡</label>
            <select id="m_type"><option>æ™¯é»</option><option>ä½å®¿</option><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>å…¶ä»–</option></select>
            <label>åœ°é»/é …ç›®åç¨±</label>
            <input type="text" id="m_title" placeholder="è«‹è¼¸å…¥åœ°é»åç¨±">
            <label>æŠµé”æ™‚é–“</label>
            <input type="time" id="m_time" style="width:100%;">
            <label>åœ°å€ (å°‡é€£å‹• Google Maps App)</label>
            <input type="text" id="m_addr" placeholder="è¼¸å…¥åœ°å€æˆ–é—œéµå­—">
            <label>ç‡Ÿæ¥­æ™‚é–“ / è³‡è¨Š</label>
            <input type="text" id="m_hours" placeholder="ä¾‹å¦‚: 09:00 - 18:00">
            <label>é è¨ˆé–€ç¥¨è²»ç”¨</label>
            <input type="text" id="m_ticket" placeholder="ä¾‹å¦‚: 2000 JPY">
            <label>ç‰¹è‰² & è¡Œå‰å‚™è¨»</label>
            <textarea id="m_note" rows="3" placeholder="æœ‰ä»€éº¼è¦æ³¨æ„çš„å‘¢ï¼Ÿ"></textarea>
            <button class="save-btn" onclick="saveTr()">ç¢ºèªå„²å­˜</button>
            <button onclick="closeModal()" style="width:100%; border:none; background:none; color:#aaa; margin-top:15px; font-size:0.9rem;">å–æ¶ˆè¿”å›</button>`;
        document.getElementById('modal').style.display = 'flex';
    }

    function openEdit(i) {
        editIdx = i;
        const it = tripData[dayIdx][i];
        const inner = document.getElementById('modalInner');
        inner.innerHTML = `
            <h3 style="margin:0 0 10px; color:var(--blue);">ç·¨è¼¯è¡Œç¨‹é …ç›®</h3>
            <label>è¡Œç¨‹åˆ†é¡</label>
            <select id="m_type"><option ${it.type==='æ™¯é»'?'selected':''}>æ™¯é»</option><option ${it.type==='ä½å®¿'?'selected':''}>ä½å®¿</option><option ${it.type==='ç¾é£Ÿ'?'selected':''}>ç¾é£Ÿ</option><option ${it.type==='è³¼ç‰©'?'selected':''}>è³¼ç‰©</option><option ${it.type==='å…¶ä»–'?'selected':''}>å…¶ä»–</option></select>
            <label>åœ°é»/é …ç›®åç¨±</label>
            <input type="text" id="m_title" value="${it.title}">
            <label>æŠµé”æ™‚é–“</label>
            <input type="time" id="m_time" value="${it.time}">
            <label>åœ°å€</label>
            <input type="text" id="m_addr" value="${it.addr || ''}">
            <label>ç‡Ÿæ¥­æ™‚é–“ / è³‡è¨Š</label>
            <input type="text" id="m_hours" value="${it.hours || ''}">
            <label>é è¨ˆé–€ç¥¨è²»ç”¨</label>
            <input type="text" id="m_ticket" value="${it.ticket || ''}">
            <label>ç‰¹è‰² & è¡Œå‰å‚™è¨»</label>
            <textarea id="m_note" rows="3">${it.note || ''}</textarea>
            <button class="save-btn" onclick="saveTr()">å„²å­˜è®Šæ›´</button>
            <button onclick="delTr()" style="background:#ff6b6b; color:white; border:none; padding:12px; border-radius:15px; width:100%; margin-top:12px; font-weight:700;">åˆªé™¤æ­¤é …ç›®</button>
            <button onclick="closeModal()" style="width:100%; border:none; background:none; color:#aaa; margin-top:15px; font-size:0.9rem;">å–æ¶ˆè¿”å›</button>`;
        document.getElementById('modal').style.display = 'flex';
    }

    function saveTr() {
        const data = { 
            type: document.getElementById('m_type').value, 
            title: document.getElementById('m_title').value || 'æœªå‘½åé …ç›®', 
            time: document.getElementById('m_time').value, 
            addr: document.getElementById('m_addr').value,
            hours: document.getElementById('m_hours').value,
            ticket: document.getElementById('m_ticket').value,
            note: document.getElementById('m_note').value
        };
        if(editIdx !== null) tripData[dayIdx][editIdx] = data;
        else tripData[dayIdx].push(data);
        save(); render(); closeModal();
    }

    function delTr() { if(confirm('ç¢ºå®šè¦åˆªé™¤é€™é …è¡Œç¨‹å—ï¼Ÿ')) { tripData[dayIdx].splice(editIdx, 1); save(); render(); closeModal(); } }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    render();
</script>
</body>
</html>
